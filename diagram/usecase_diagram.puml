@startuml
left to right direction
skinparam packageStyle rectangle

actor Customer as C
actor Staff as S
actor "Payment System" as Pay

rectangle "RhythmReserve System" {

  package "Account & Profile" {
    C -- (Register)
    (Register) ..> (Provide Personal Info) : <<include>>

    C -- (Login)
    (Login) ..> (Verify Password) : <<include>>

    C -- (Manage Profile)
    C -- (Change Password)

    C -- (View Membership and Points)
    (Redeem Points) ..> (View Membership and Points) : <<extend>>

    C -- (View Booking History)
    C -- (View Notifications)
    (View Notifications) ..> (Mark Notification as Read) : <<include>>
  }

  package "Service_IN - Room Reservation (Pay at Booking)" {

    C -- (Search Available Rooms)
    (Search Available Rooms) ..> (Select Date and Time Range) : <<include>>
    (Search Available Rooms) ..> (Select Room Size) : <<include>>
    (Search Available Rooms) ..> (Check Room TimeSlot Conflicts) : <<include>>
    (Check Room TimeSlot Conflicts) ..> (Detect Overlap) : <<include>>
    (Search Available Rooms) ..> (Show Available Rooms and Time Slots) : <<include>>

    C -- (Start Service_IN Cart)

    C -- (View Service_IN Summary)
    (View Service_IN Summary) ..> (Calculate Service_IN Total) : <<include>>
    (Apply Coupon) ..> (View Service_IN Summary) : <<extend>>

    C -- (Add Booking Room+Equipment to Service_IN)
    (Add Booking Room+Equipment to Service_IN) ..> (Select Room) : <<include>>
    (Add Booking Room+Equipment to Service_IN) ..> (Select Date and Time Range) : <<include>>

    (Add Booking Room+Equipment to Service_IN) ..> (Select Equipment for This Room) : <<include>>
    (Select Equipment for This Room) ..> (Validate Equipment Quota eq_quota) : <<include>>
    (Select Equipment for This Room) ..> (Check Equipment TimeSlot Conflicts) : <<include>>
    (Check Equipment TimeSlot Conflicts) ..> (Detect Overlap) : <<include>>

    (Add Booking Room+Equipment to Service_IN) ..> (Lock Room Time_slot) : <<include>>
    (Lock Room Time_slot) ..> (Create Room Time_slot RESERVED) : <<include>>

    (Add Booking Room+Equipment to Service_IN) ..> (Lock Equipment Time_slot) : <<include>>
    (Lock Equipment Time_slot) ..> (Create Equipment Time_slot RESERVED) : <<include>>

    (Add Booking Room+Equipment to Service_IN) ..> (Create Booking) : <<include>>
    (Add Booking Room+Equipment to Service_IN) ..> (Add Booking into Service_IN) : <<include>>
    (Add Booking Room+Equipment to Service_IN) ..> (Calculate Booking Price) : <<include>>

    C -- (Remove Booking from Service_IN)
    (Remove Booking from Service_IN) ..> (Release Room and Equipment Time_slot) : <<include>>

    C -- (Cancel Booking)
    (Cancel Booking) ..> (Check Cancellation Policy) : <<include>>
    (Cancel Booking) ..> (Update Time_slot to AVAILABLE) : <<include>>
    (Refund if Allowed) ..> (Cancel Booking) : <<extend>>
    (Refund if Allowed) ..> Pay : <<include>>

    C -- (Checkout Service_IN)
    (Checkout Service_IN) ..> (Process Payment for Service_IN Total) : <<include>>
    (Process Payment for Service_IN Total) ..> Pay : <<include>>
    (Checkout Service_IN) ..> (Confirm All Bookings) : <<include>>
    (Checkout Service_IN) ..> (Send Notification) : <<include>>
  }

  package "Service_OUT - Snacks/Drinks and Penalties (Pay Later)" {

    C -- (Browse Stock)
    (Browse Stock) ..> (View Product List) : <<include>>

    C -- (Buy Snacks and Drinks)
    (Buy Snacks and Drinks) ..> (Select Items) : <<include>>
    (Buy Snacks and Drinks) ..> (Create Service_OUT Order) : <<include>>
    (Buy Snacks and Drinks) ..> (Calculate Service_OUT Total) : <<include>>
    (Buy Snacks and Drinks) ..> (Process Payment - Service_OUT) : <<include>>
    (Process Payment - Service_OUT) ..> Pay : <<include>>
    (Buy Snacks and Drinks) ..> (Send Notification) : <<include>>

    C -- (View Penalties)
    C -- (Pay Penalty or Damage Charge)
    (Pay Penalty or Damage Charge) ..> (View Penalties) : <<include>>
    (Pay Penalty or Damage Charge) ..> (Process Payment - Service_OUT) : <<include>>
  }

  package "Issue and Support" {
    C -- (Report Room or Equipment Issue)
  }

  package "Staff Operations" {

    S -- (Staff Login)
    (Staff Login) ..> (Verify Password) : <<include>>

    S -- (View Daily Booking List)

    S -- (Customer Check-in)
    (Customer Check-in) ..> (Verify Booking) : <<include>>
    (Customer Check-in) ..> (Update Time_slot to OCCUPIED) : <<include>>
    (Customer Check-in) ..> (Update Room Status) : <<include>>
    (Update Equipment Status) ..> (Customer Check-in) : <<extend>>

    S -- (Customer Check-out)
    (Customer Check-out) ..> (Update Time_slot to AVAILABLE) : <<include>>
    (Customer Check-out) ..> (Update Room Status) : <<include>>
    (Update Equipment Status) ..> (Customer Check-out) : <<extend>>
    (Record Damage or Issue) ..> (Customer Check-out) : <<extend>>
    (Record Damage or Issue) ..> (Create Penalty) : <<include>>
    (Create Penalty) ..> (Send Notification) : <<include>>

    S -- (Manage Rooms)
    (Manage Rooms) ..> (Add Room) : <<include>>
    (Manage Rooms) ..> (Set Room Maintenance) : <<include>>

    S -- (Manage Equipment)
    (Manage Equipment) ..> (Add Equipment) : <<include>>
    (Manage Equipment) ..> (Set Equipment Maintenance) : <<include>>

    S -- (Manage Stock)
    (Manage Stock) ..> (Add Product) : <<include>>
    (Manage Stock) ..> (Remove Product) : <<include>>

    S -- (Manage Policy)
    (Manage Policy) ..> (Manage Cancellation Rules) : <<include>>
    (Manage Policy) ..> (Manage Penalty Rules) : <<include>>

    S -- (Manage Pricing)

    S -- (Manage Coupons)
    (Manage Coupons) ..> (Add Coupon) : <<include>>
    (Manage Coupons) ..> (Remove Coupon) : <<include>>
    (Add Coupon) ..> (Set Expire Date) : <<include>>
  }
}
@enduml